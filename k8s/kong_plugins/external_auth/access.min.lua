local a=require"socket.http"local b={}local function c(d)return string.format("%%%02X",string.byte(d))end;local function e(f)if f==nil then return end;f=f:gsub("\n","\r\n")f=f:gsub("([^%w ])",c)f=f:gsub(" ","+")return f end;local function g(h)local f=kong.request.get_host()..kong.request.get_path()local i=kong.request.get_header('authorization')i=i:gsub("Bearer ","")local j=h.auth_endpoint..'?url='..e(f)..'&token='..e(i)local k,d,l=a.request(j)if d==401 then kong.response.exit(401)end end;function b.execute(h)g(h)end;return b